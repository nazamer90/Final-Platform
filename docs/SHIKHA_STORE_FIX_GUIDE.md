# ุฏููู ุญู ูุดุงูู ูุชุฌุฑ ุดูุฎุฉ

## ููุฎุต ุงููุดุงูู

### 1. ูุดููุฉ ุนุฑุถ ุงููุชุฌุฑ
- **ุงููุดููุฉ**: `/api/stores/public/shikha` ูุนูุฏ ุฎุทุฃ 404
- **ุงูุณุจุจ**: ุงูุณุฌู ูู ูููุดุฃ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุณุจุจ ูุดู ูู ุนูููุฉ ุงูุฅูุดุงุก
- **ุงููุชูุฌุฉ**: ุงููุงุฌูุฉ ุชุญุงูู ุชุญููู ุงูุตูุฑ ูู `/assets/shikha/...` ูุชูุดู

### 2. ูุดููุฉ ุญุฐู ุงููุชุฌุฑ  
- **ุงููุดููุฉ**: ุฎุทุฃ "Bucket not found" ุนูุฏ ูุญุงููุฉ ุงูุญุฐู
- **ุงูุณุจุจ**: 
  - ุงุณุชุฎุฏุงู endpoint ุฎุงุทุฆ ูู API Supabase (`/object/remove/` ุจุฏูุงู ูู `/object/`)
  - ุงุณุชุฎุฏุงู POST ุจุฏูุงู ูู DELETE
  - ุนุฏู ูุนุงูุฌุฉ ุญุงูุฉ ุนุฏู ูุฌูุฏ ุงูุจููุช ุจุดูู ุตุญูุญ

## ุงูุฅุตูุงุญุงุช ุงููููุฐุฉ

### โ 1. ุฅุตูุงุญ Supabase Storage API

ุชู ุชุนุฏูู ุงูููู `backend/src/services/supabaseStorage.ts`:

#### ุฃ) ุฅุตูุงุญ `removeSupabaseObjects`:
```typescript
// ูุจู ุงูุฅุตูุงุญ
const endpoint = `${url}/storage/v1/object/remove/${bucket}`;
method: 'POST'

// ุจุนุฏ ุงูุฅุตูุงุญ  
const endpoint = `${url}/storage/v1/object/${bucket}`;
method: 'DELETE'
```

#### ุจ) ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฎุทุฃ "Bucket not found":
```typescript
if (status === 404 || text.includes('not found') || text.includes('Bucket not found')) {
  console.warn(`Supabase bucket or objects not found, treating as already deleted`);
  return true;
}
```

#### ุฌ) ุชุญุณูู `deleteSupabasePrefix`:
- ุฅุถุงูุฉ try-catch ููุชุนุงูู ูุน ุงูุฃุฎุทุงุก
- ูุนุงูุฌุฉ ุญุงูุฉ ุนุฏู ูุฌูุฏ ุงูุจููุช ุฃู ุงููููุงุช
- ุงุณุชูุฑุงุฑ ุงูุนูููุฉ ุจุฏูุงู ูู ุงูุชููู

### โ 2. ุฅูุดุงุก ุณูุฑูุจุช ุชูุธูู ูุฏูู

ุชู ุฅูุดุงุก `backend/cleanup_shikha_store.ts` ููุชูุธูู ุงููุงูู ูุจูุงูุงุช ุงููุชุฌุฑ.

## ุฎุทูุงุช ุงูุญู ุงููุทููุจุฉ

### ุงููุฑุญูุฉ 1: ุชุญุฏูุซ Render Backend

1. **ุชุฃูุฏ ูู ุงููุชุบูุฑุงุช ุงูุจูุฆูุฉ ูู Render**:
   ```
   SUPABASE_URL=https://wbakbuqvdbmweujkbzxn.supabase.co
   SUPABASE_SERVICE_ROLE_KEY=eyJ... (ุงูููุชุงุญ ุงููุงูู)
   SUPABASE_STORAGE_BUCKET=ishro-assets
   ```

2. **ุชุญุฏูุซ Render ุจุขุฎุฑ ููุฏ**:
   - ุงูููุฏ ุชู ุฑูุนู ุฅูู ุงููุฑุน `capy/cap-1-fbb6a5c5`
   - ุงูุชุธุฑ ุฅุนุงุฏุฉ ูุดุฑ Render ุชููุงุฆูุงู ุฃู ูู ุจุนูู "Manual Deploy"

3. **ุชุญูู ูู ุงูุณุฌูุงุช (logs)**:
   ```
   Supabase env: {
     url: 'https://wbakbuqvdbmweujkbzxn.supabase.co',
     bucket: 'ishro-assets',
     hasServiceRole: true
   }
   ```

### ุงููุฑุญูุฉ 2: ุงูุชุญูู ูู Supabase

1. **ุงูุชุญ Supabase Dashboard**: https://supabase.com/dashboard
2. **ุงุฐูุจ ุฅูู Project Settings โ API**
3. **ุชุฃูุฏ ูู**:
   - Service Role Key ุตุญูุญ (eyJ...)
   - URL ุตุญูุญ: `https://wbakbuqvdbmweujkbzxn.supabase.co`

4. **ุงุฐูุจ ุฅูู Storage โ Buckets**
5. **ุชุฃูุฏ ูู ูุฌูุฏ bucket ุงุณูู `ishro-assets`**:
   - ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุฃูุดุฆู
   - ุงุถุจุท ุฅุนุฏุงุฏุงุช Public Access: โ Public bucket (ูููุฑุงุกุฉ ููุท)

6. **ุชุญูู ูู ุงููููุงุช**:
   - ุงูุชุญ bucket `ishro-assets`
   - ุงุจุญุซ ุนู ูุฌูุฏ `stores/shikha/`
   - ุฅุฐุง ูุงูุช ุงููููุงุช ููุฌูุฏุฉุ ูุฐุง ูุคูุฏ ุฃู ุงูุฑูุน ูุฌุญ

### ุงููุฑุญูุฉ 3: ุชูุธูู ุจูุงูุงุช ุดูุฎุฉ ุงููุฏููุฉ

#### ุงูุทุฑููุฉ 1: ุงุณุชุฎุฏุงู ุณูุฑูุจุช ุงูุชูุธูู (ููุตู ุจู)

```bash
# ุนูู Render ุฃู ุนูู ุฌูุงุฒู ุงููุญูู
cd backend
npx tsx cleanup_shikha_store.ts
```

#### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู API ุงูุญุฐู ุงูุฅุฏุงุฑู

```powershell
curl.exe -X DELETE "https://final-platform-eshro.onrender.com/api/stores/admin/shikha" `
  -H "x-admin-key: adminkey-NiZ!aR^2026"
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ ุงูุขู** (ุจุนุฏ ุงูุฅุตูุงุญ):
```json
{
  "success": true,
  "data": {
    "slug": "shikha",
    "removedFromIndex": false,
    "removedAssetDirs": [],
    "supabase": {
      "attempted": true,
      "deleted": 0  // ุฃู ุนุฏุฏ ุงููููุงุช ุงููุญุฐููุฉ
    },
    "db": {
      "attempted": true,
      "deleted": true
    },
    "warnings": []  // ุจุฏูู ุชุญุฐูุฑุงุช "Bucket not found"
  }
}
```

### ุงููุฑุญูุฉ 4: ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุชุฌุฑ

ุจุนุฏ ุงูุชูุธูู ุงููุงูู:

1. **ุงูุชุญ ุงูููุตุฉ**: https://www.ishro.ly
2. **ุงุฐูุจ ุฅูู ุตูุญุฉ ุฅูุดุงุก ูุชุฌุฑ ุฌุฏูุฏ**
3. **ุฃุฏุฎู ุงูุจูุงูุงุช**:
   - ุงุณู ุงููุชุฌุฑ: ุดูุฎุฉ ููุนุจุงูุงุช
   - slug: shikha
   - ุงูุจุฑูุฏ ุงูุฅููุชุฑููู
   - ูููุฉ ุงููุฑูุฑ
   - ุฑูู ุงููุงุชู
4. **ุงุฑูุน ุงูุตูุฑ**: ุงูุดุนุงุฑุ ุงูุณูุงูุฏุฑุ ูุงูููุชุฌุงุช
5. **ุงููุฑ "ุฅูุดุงุก ุงููุชุฌุฑ"**

**ุฑุงูุจ ุงูุณุฌูุงุช ูู Render** ููุชุฃูุฏ ูู:
```
โ๏ธ Uploading store assets to Supabase bucket...
โ Supabase uploads completed
โ store.json uploaded to Supabase
๐พ Merchant credentials, store, sliders, and ads stored for shikha
๐ Store creation completed successfully
```

6. **ุงุฎุชุจุฑ ุงููุตูู**:
```bash
curl https://final-platform-eshro.onrender.com/api/stores/public/shikha
```

ูุฌุจ ุฃู ูุนูุฏ JSON ูุงูู ุนู ุงููุชุฌุฑ ูุน ุฑูุงุจุท Supabase ููุตูุฑ.

7. **ุงูุชุญ ุงููุชุฌุฑ**: https://www.ishro.ly/shikha

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ 500 ุนูุฏ ุงูุฅูุดุงุก

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ**:
1. **ุนุฏุฏ ุงูุตูุฑ ูุจูุฑ ุฌุฏุงู**:
   - ุงูุญู: ููู ุนุฏุฏ ุงูุตูุฑ (10-15 ููุชุฌ ูุญุฏ ุฃูุตู)
   
2. **ุญุฌู ุงูุตูุฑ ูุจูุฑ**:
   - ุงูุญู: ุถุบุท ุงูุตูุฑ ูุจู ุงูุฑูุน (< 2MB ููู ุตูุฑุฉ)

3. **ูุดููุฉ ูู ุงูููุงุชูุญ**:
   - ุฑุงุฌุน ุงูุณุฌูุงุช: `โ Supabase upload failed`
   - ุชุฃูุฏ ูู ุตุญุฉ `SUPABASE_SERVICE_ROLE_KEY`

### ุฎุทุฃ 409 (Conflict)

**ุงูุณุจุจ**: ุงููุชุฌุฑ ุฃู ุงูุจุฑูุฏ ููุฌูุฏ ูุณุจูุงู

**ุงูุญู**: ููุฐ ุงูุชูุธูู ุงููุงูู ุฃููุงู (ุงููุฑุญูุฉ 3)

### ุงูุตูุฑ ูุง ุชุธูุฑ (404)

**ุงูุณุจุจ**: Supabase URL ุฎุงุทุฆ ุฃู ุงูุจููุช ููุณ public

**ุงูุญู**:
1. ุชุฃูุฏ ูู ุฃู bucket `ishro-assets` ูู Public
2. ุชุญูู ูู ุฑูุงุจุท ุงูุตูุฑ ูู response:
   ```json
   "logo": "https://wbakbuqvdbmweujkbzxn.supabase.co/storage/v1/object/public/ishro-assets/stores/shikha/logo/..."
   ```
3. ุงูุชุญ ุงูุฑุงุจุท ูุจุงุดุฑุฉ ูู ุงููุชุตูุญ ููุชุฃูุฏ

## ููุงุญุธุงุช ูููุฉ

### ุชุฑุชูุจ ุงูุนูููุงุช
1. โ ุชุญุฏูุซ ุงูููุฏ ูู Render
2. โ ุงูุชุญูู ูู ุฅุนุฏุงุฏุงุช Supabase
3. โ ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ
4. โ ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุชุฌุฑ
5. โ ุงุฎุชุจุงุฑ ุงููุตูู

### ุฅุฐุง ูุดู ูู ุดูุก

**ุฅูุดุงุก ุงูุจููุช ูุฏููุงู**:
1. ุงุฐูุจ ุฅูู Supabase Dashboard โ Storage
2. ุงููุฑ "New bucket"
3. ุงูุงุณู: `ishro-assets`
4. โ Public bucket
5. ุงููุฑ "Create bucket"

**ุฅุนุงุฏุฉ ุชุฏููุฑ Service Role Key**:
1. ุงุฐูุจ ุฅูู Project Settings โ API
2. ูู Service Role Keyุ ุงููุฑ "Regenerate"
3. ุงูุณุฎ ุงูููุชุงุญ ุงูุฌุฏูุฏ
4. ุญุฏูุซ ูู Render Environment Variables:
   ```
   SUPABASE_SERVICE_ROLE_KEY=<ุงูููุชุงุญ ุงูุฌุฏูุฏ>
   ```
5. Manual Deploy ูู Render

## ุงูุชุญูู ุงูููุงุฆู

ุจุนุฏ ุฅููุงู ุฌููุน ุงูุฎุทูุงุช:

### โ Checklist

- [ ] ุงูููุฏ ูุญุฏุซ ูู Render ูุชู ุฅุนุงุฏุฉ ุงููุดุฑ
- [ ] ูุชุบูุฑุงุช Supabase ุตุญูุญุฉ ูู Render
- [ ] ุงูุจููุช `ishro-assets` ููุฌูุฏ ููู Public
- [ ] ุชู ุชูุธูู ุจูุงูุงุช ุดูุฎุฉ ุงููุฏููุฉ ุจูุฌุงุญ
- [ ] ุชู ุฅูุดุงุก ุงููุชุฌุฑ ุจูุฌุงุญ (200/201 response)
- [ ] `/api/stores/public/shikha` ูุนูุฏ JSON ุตุญูุญ
- [ ] ุงูุตูุฑ ุชุธูุฑ ูู ุงููููุน
- [ ] ูููู ุงููุตูู ุฅูู https://www.ishro.ly/shikha

## ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดุงูู:

1. **ุฑุงุฌุน ุงูุณุฌูุงุช ูู ุงูููุช ุงููุนูู**:
   - Render Dashboard โ Logs
   - ุงุจุญุซ ุนู `shikha` ุฃู `Supabase`

2. **ุงุฎุชุจุฑ ุงูุงุชุตุงู ุจู Supabase**:
   ```bash
   curl -H "Authorization: Bearer <SERVICE_ROLE_KEY>" \
        -H "apikey: <SERVICE_ROLE_KEY>" \
        "https://wbakbuqvdbmweujkbzxn.supabase.co/storage/v1/bucket/ishro-assets"
   ```

3. **ุดุงุฑู ุงูุณุฌูุงุช** ููุชุญููู ุงูุฏููู

---

## ุงูููุฎุต ุงูุชูููุฐู

ุชู ุฅุตูุงุญ ูุดููุชูู ุฑุฆูุณูุชูู:

### 1๏ธโฃ ุฅุตูุงุญ Supabase Storage API
- ุชุบููุฑ endpoint ูู `/object/remove/` ุฅูู `/object/`
- ุชุบููุฑ HTTP method ูู POST ุฅูู DELETE  
- ุฅุถุงูุฉ ูุนุงูุฌุฉ ูุฎุทุฃ "Bucket not found"

### 2๏ธโฃ ุฅูุดุงุก ุณูุฑูุจุช ุชูุธูู ุดุงูู
- ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฑุชุจุทุฉ ุจูุชุฌุฑ ุดูุฎุฉ
- ุฅููุงููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุจุฏูู ุชุนุงุฑุถุงุช

### ุงูุฎุทูุงุช ุงููุทููุจุฉ ููู:
1. โ ุชุญุฏูุซ Render (ุชููุงุฆู ุนูุฏ merge ุฃู Manual Deploy)
2. โ ุงูุชุญูู ูู Supabase bucket
3. โ ุชูููุฐ ุงูุชูุธูู
4. โ ุฅุนุงุฏุฉ ุฅูุดุงุก ุงููุชุฌุฑ

**ุงูููุช ุงููุชููุน**: 10-15 ุฏูููุฉ
