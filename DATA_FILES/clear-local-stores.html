<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<script type="text/javascript">
  // This is a CodeSandbox injection script that's used to
  // add navigation and inspector functionality to the preview
  (function () {
    // 1) Get the <script> tag that's currently running:
    var me = document.currentScript;

    // 2) Create the blockingâ€style <script> to load:
    var script = document.createElement("script");
    script.src = "https://codesandbox.io/p/preview-protocol.js";

    // By default a dynamicallyâ€inserted <script> is async=true.
    // Turn async off to make it behave like a normal blocking <script>:
    script.async = false;
    // (Do NOT set defer.)

    // 3) Insert it immediately after the current <script>:
    me.parentNode.insertBefore(script, me);
  })();

  const isIFramePreview = window.top !== window.self;

  // Only run this script in editor context
  if (isIFramePreview) {
    // This script is used to enable Chrome DevTools functionality
    (function () {
      var script = document.createElement("script");
      script.src =
        "https://codesandbox.io/p/chrome-devtool/protocol/index.js";

      script.onload = () => {
        const devtoolProtocol = window.chobitsu;
        if (devtoolProtocol) {
          window.addEventListener("message", (event) => {
            const { type, data } = event.data;

            if (type === "FROM_DEVTOOL") {
              devtoolProtocol.sendRawMessage(data);
            }
          });

          devtoolProtocol.setOnMessage((data) => {
            if (data.includes('"id":"tmp')) {
              return;
            }

            window.parent.postMessage({ type: "TO_DEVTOOL", data }, "*");
          });

          devtoolProtocol.sendRawMessage(
            `{"id":5,"method":"Runtime.enable","params":{}}`
          );
        }        
      }

      (document.head || document.documentElement).prepend(script);
    })();
  }

  if (typeof __REACT_DEVTOOLS_GLOBAL_HOOK__ === "undefined") {
    let nextID = 0;
    let hook = (__REACT_DEVTOOLS_GLOBAL_HOOK__ = {
      renderers: new Map(),
      supportsFiber: true,
      inject: (renderer) => {
        const id = nextID++;
        hook.renderers.set(id, renderer);
        return id;
      },
      onScheduleFiberRoot() {},
      onCommitFiberRoot() {},
      onCommitFiberUnmount() {},
    });
  }

  document.currentScript.remove();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙ†Ø¸ÙŠÙ localStorage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .header h1 {
            color: #333;
            font-size: 28px;
        }
        
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-danger {
            background: #ff6b6b;
            color: white;
        }
        
        .btn-danger:hover {
            background: #ff5252;
        }
        
        .warning-box {
            background: #fff3cd;
            border-right: 4px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            color: #856404;
        }
        
        .content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .cleanup-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .item-info {
            flex: 1;
            min-width: 200px;
        }
        
        .item-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .item-desc {
            font-size: 12px;
            color: #666;
        }
        
        .item-size {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .checkbox-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
        }
        
        .message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }
        
        .message.success {
            background: #51cf66;
        }
        
        .message.error {
            background: #ff6b6b;
        }
        
        .message.info {
            background: #667eea;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§¹ ØªÙ†Ø¸ÙŠÙ localStorage</h1>
            <button onclick="window.location.href='admin-tools.html'">â† Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        </div>
        
        <div class="warning-box">
            âš ï¸ <strong>ØªØ­Ø°ÙŠØ±:</strong> ØªÙ†Ø¸ÙŠÙ localStorage Ù‚Ø¯ ÙŠØ¤Ø¯ÙŠ Ù„ÙÙ‚Ø¯Ø§Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ù…Ø­Ù„ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
        </div>
        
        <div class="content">
            <div class="stats" id="stats"></div>
            
            <div class="section">
                <h2>ğŸ§¹ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙ†Ø¸ÙŠÙ:</h2>
                
                <div class="cleanup-item">
                    <div class="item-info">
                        <div class="item-title">ğŸ“¦ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
                        <div class="item-desc">Ø­Ø°Ù Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø± (eshro_stores)</div>
                        <div class="item-size" id="mainStoresSize"></div>
                    </div>
                    <input type="checkbox" id="clearMainStores" class="cleanup-checkbox">
                </div>
                
                <div class="cleanup-item">
                    <div class="item-info">
                        <div class="item-title">ğŸ“ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± Ø§Ù„ÙØ±Ø¯ÙŠØ©</div>
                        <div class="item-desc">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ØªØ§Ø¬Ø± (eshro_store_files_*)</div>
                        <div class="item-size" id="storeFilesSize"></div>
                    </div>
                    <input type="checkbox" id="clearStoreFiles" class="cleanup-checkbox">
                </div>
                
                <div class="cleanup-item">
                    <div class="item-info">
                        <div class="item-title">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>
                        <div class="item-desc">Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</div>
                        <div class="item-size" id="productsSize"></div>
                    </div>
                    <input type="checkbox" id="clearProducts" class="cleanup-checkbox">
                </div>
                
                <div class="cleanup-item">
                    <div class="item-info">
                        <div class="item-title">ğŸ–¼ï¸ Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø´Ø±Ø§Ø¦Ø­</div>
                        <div class="item-desc">Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ± ÙˆØ§Ù„Ø´Ø±Ø§Ø¦Ø­</div>
                        <div class="item-size" id="imagesSize"></div>
                    </div>
                    <input type="checkbox" id="clearImages" class="cleanup-checkbox">
                </div>
                
                <div class="cleanup-item">
                    <div class="item-info">
                        <div class="item-title">âš™ï¸ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Eishro</div>
                        <div class="item-desc">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Eishro Ù…Ù† localStorage</div>
                    </div>
                    <button class="btn-danger" onclick="clearAll()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
                </div>
            </div>
            
            <div style="text-align:center;margin-top:30px;">
                <button class="btn-danger" onclick="clearSelected()" style="padding:15px 40px;font-size:16px;">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø®ØªØ§Ø±</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">âš ï¸ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</div>
            <p id="confirmText" style="margin-bottom:15px;color:#666;"></p>
            <div class="modal-footer">
                <button onclick="closeConfirm()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-danger" onclick="confirmClear()">Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</button>
            </div>
        </div>
    </div>
    
    <script>
        let selectedItems = new Set();
        
        function getStorageSize() {
            let size = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    size += localStorage[key].length + key.length;
                }
            }
            return (size / 1024).toFixed(2);
        }
        
        function updateStats() {
            let stats = {
                mainStores: 0,
                storeFiles: 0,
                products: 0,
                images: 0,
                totalSize: 0
            };
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key === 'eshro_stores') stats.mainStores = 1;
                else if (key.startsWith('eshro_store_files_')) stats.storeFiles++;
                else if (key.includes('product') || key.includes('category')) stats.products++;
                else if (key.includes('image') || key.includes('slide')) stats.images++;
            }
            
            const totalSize = getStorageSize();
            
            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalSize}</div>
                    <div class="stat-label">Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (KB)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${localStorage.length}</div>
                    <div class="stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.storeFiles}</div>
                    <div class="stat-label">Ù…Ù„ÙØ§Øª Ù…ØªØ§Ø¬Ø±</div>
                </div>
            `;
            
            document.getElementById('mainStoresSize').textContent = `Ø­Ø¬Ù…: ${calculateKeySize('eshro_stores')} KB`;
            document.getElementById('storeFilesSize').textContent = `${stats.storeFiles} Ù…Ù„Ù | Ø­Ø¬Ù…: ${calculateStoreFilesSize()} KB`;
            document.getElementById('productsSize').textContent = `Ø­Ø¬Ù…: ${calculatePatternSize('product|category')} KB`;
            document.getElementById('imagesSize').textContent = `Ø­Ø¬Ù…: ${calculatePatternSize('image|slide')} KB`;
        }
        
        function calculateKeySize(key) {
            const value = localStorage.getItem(key) || '';
            return (value.length / 1024).toFixed(2);
        }
        
        function calculateStoreFilesSize() {
            let size = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('eshro_store_files_')) {
                    size += (localStorage.getItem(key) || '').length;
                }
            }
            return (size / 1024).toFixed(2);
        }
        
        function calculatePatternSize(pattern) {
            let size = 0;
            const regex = new RegExp(pattern);
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (regex.test(key)) {
                    size += (localStorage.getItem(key) || '').length;
                }
            }
            return (size / 1024).toFixed(2);
        }
        
        document.querySelectorAll('.cleanup-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    selectedItems.add(this.id);
                } else {
                    selectedItems.delete(this.id);
                }
            });
        });
        
        function clearSelected() {
            if (selectedItems.size === 0) {
                showMessage('Ø§Ø®ØªØ± Ø¹Ù†Ø§ØµØ± Ù„Ù„Ø­Ø°Ù Ø£ÙˆÙ„Ø§Ù‹', 'info');
                return;
            }
            
            document.getElementById('confirmText').textContent = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©ØŸ Ù‡Ø°Ù‡ Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.`;
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function clearAll() {
            document.getElementById('confirmText').textContent = `Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Eishro Ù…Ù† localStorageØŸ Ù‡Ø°Ù‡ Ø¹Ù…Ù„ÙŠØ© Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡Ø§.`;
            selectedItems = new Set(['clearAll']);
            document.getElementById('confirmModal').classList.add('active');
        }
        
        function closeConfirm() {
            document.getElementById('confirmModal').classList.remove('active');
            selectedItems.clear();
        }
        
        function confirmClear() {
            closeConfirm();
            
            showMessage('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­Ø°Ù...', 'info');
            
            try {
                if (selectedItems.has('clearAll')) {
                    for (let i = localStorage.length - 1; i >= 0; i--) {
                        const key = localStorage.key(i);
                        if (key.startsWith('eshro_')) {
                            localStorage.removeItem(key);
                        }
                    }
                } else {
                    if (selectedItems.has('clearMainStores')) {
                        localStorage.removeItem('eshro_stores');
                    }
                    
                    if (selectedItems.has('clearStoreFiles')) {
                        for (let i = localStorage.length - 1; i >= 0; i--) {
                            const key = localStorage.key(i);
                            if (key.startsWith('eshro_store_files_')) {
                                localStorage.removeItem(key);
                            }
                        }
                    }
                    
                    if (selectedItems.has('clearProducts')) {
                        for (let i = localStorage.length - 1; i >= 0; i--) {
                            const key = localStorage.key(i);
                            if (key.includes('product') || key.includes('category')) {
                                if (key.startsWith('eshro_')) {
                                    localStorage.removeItem(key);
                                }
                            }
                        }
                    }
                    
                    if (selectedItems.has('clearImages')) {
                        for (let i = localStorage.length - 1; i >= 0; i--) {
                            const key = localStorage.key(i);
                            if (key.includes('image') || key.includes('slide')) {
                                if (key.startsWith('eshro_')) {
                                    localStorage.removeItem(key);
                                }
                            }
                        }
                    }
                }
                
                document.querySelectorAll('.cleanup-checkbox').forEach(cb => cb.checked = false);
                selectedItems.clear();
                updateStats();
                showMessage('âœ… ØªÙ… Ø§Ù„ØªÙ†Ø¸ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                showMessage(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
        }
        
        function showMessage(text, type) {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.textContent = text;
            document.body.appendChild(msg);
            setTimeout(() => msg.remove(), 3000);
        }
        
        updateStats();
    </script>
</body>
</html>
