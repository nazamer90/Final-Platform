import{u as M,r as c,j as e,L as b,B as O,f as w,O as _}from"./index-CcNjQh2v.js";import{S as v,a as y,b as S,c as L,d as k}from"./select-CA2aZ3FQ.js";import{B}from"./badge-DXI0UTzt.js";import{b as T,l as E}from"./cities-BeLIDABV.js";import{L as U,M as z,T as A,a as V,P as $}from"./leaflet-BMOsD6tr.js";import{M as D}from"./map-pin-Don1UAO2.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],R=M("loader-circle",G);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],J=M("navigation",H),Z=({selectedCity:i,selectedArea:o,onCityChange:x,onAreaChange:d,onLocationDetected:u,className:P="",required:h=!1})=>{const[m,p]=c.useState([]),[a,C]=c.useState(null),[f,g]=c.useState(!1),[j,l]=c.useState(null);c.useEffect(()=>{if(i){const s=T(i);p(t=>JSON.stringify(t)===JSON.stringify(s)?t:s),o&&!s.find(t=>t.id===o)&&d("")}else p([]),o&&d("")},[i,o,d]),c.useEffect(()=>{U.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-shadow.png"})},[]);const F=s=>{s!==i&&requestAnimationFrame(()=>{x(s),d("")})},I=async()=>{if(!navigator.geolocation){l("متصفحك لا يدعم تحديد الموقع");return}g(!0),l(null);try{const s=await new Promise((n,r)=>{navigator.geolocation.getCurrentPosition(n,r,{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})}),t={latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy};try{const r=await(await fetch(`https://api.openstreetmap.org/reverse?lat=${t.latitude}&lon=${t.longitude}&format=json&accept-language=ar,en`)).json();r&&r.display_name&&(t.address=r.display_name)}catch{}if(C(t),u&&u(t),t.address){const n=t.address.toLowerCase(),r=E.find(N=>n.includes(N.name.toLowerCase())||N.name.toLowerCase().includes("طرابلس")&&n.includes("tripoli"));r&&r.id!==i&&x(r.id)}}catch(s){if(s instanceof GeolocationPositionError)switch(s.code){case s.PERMISSION_DENIED:l("تم رفض الإذن للوصول للموقع. يرجى السماح للموقع بالوصول لموقعك.");break;case s.POSITION_UNAVAILABLE:l("لا يمكن تحديد موقعك حالياً. تأكد من تفعيل GPS.");break;case s.TIMEOUT:l("انتهت مهلة تحديد الموقع. يرجى المحاولة مرة أخرى.");break;default:l("حدث خطأ غير معروف في تحديد الموقع.")}else l("حدث خطأ في تحديد الموقع. يرجى المحاولة مرة أخرى.")}finally{g(!1)}};return e.jsxs("div",{className:`grid grid-cols-1 md:grid-cols-2 gap-4 transition-opacity duration-300 ${P}`,style:{minHeight:"120px",background:"transparent"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"city-select",children:["المدينة ",h&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(v,{value:i,onValueChange:F,children:[e.jsx(y,{id:"city-select",children:e.jsx(S,{placeholder:"اختر المدينة"})}),e.jsx(L,{children:E.map(s=>e.jsx(k,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"area-select",children:["المنطقة ",h&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(v,{value:o,onValueChange:d,children:[e.jsx(y,{id:"area-select",disabled:!i||m.length===0,children:e.jsx(S,{placeholder:i?m.length===0?"لا توجد مناطق متاحة":"اختر المنطقة":"اختر المدينة أولاً"})}),e.jsx(L,{children:m.map(s=>e.jsx(k,{value:s.id,children:s.name},s.id))})]})]}),e.jsxs("div",{className:"col-span-full",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between p-4 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(D,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-900",children:"تحديد الموقع التلقائي"}),e.jsx("p",{className:"text-sm text-slate-600",children:"استخدم GPS لتحديد موقعك تلقائياً"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 min-w-0 flex-1 sm:flex-initial sm:min-w-[200px]",children:[e.jsx(O,{variant:"outline",size:"sm",onClick:I,disabled:f,className:"w-full sm:w-auto",children:f?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-4 w-4 animate-spin mr-2"}),"جاري التحديد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"تحديد موقعي"]})}),a&&e.jsxs(B,{variant:"secondary",className:"text-xs w-full sm:w-auto justify-center",children:[e.jsx(w,{className:"h-3 w-3 ml-1"}),"تم تحديد الموقع"]})]})]}),a&&e.jsx("div",{className:"mt-3 p-3 bg-green-50 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx(w,{className:"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-green-800 mb-1",children:"تم تحديد موقعك بنجاح"}),e.jsxs("div",{className:"text-xs text-green-700 space-y-1",children:[e.jsxs("p",{children:["خط الطول: ",a.longitude.toFixed(6)]}),e.jsxs("p",{children:["خط العرض: ",a.latitude.toFixed(6)]}),e.jsxs("p",{children:["الدقة: ",Math.round(a.accuracy)," متر"]}),a.address&&e.jsxs("p",{className:"break-words",children:["العنوان: ",a.address]})]})]})]})}),a&&e.jsx("div",{className:"col-span-full mt-4",children:e.jsxs(z,{center:[a.latitude,a.longitude],zoom:13,style:{height:"300px",width:"100%"},children:[e.jsx(A,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}),e.jsx(V,{position:[a.latitude,a.longitude],children:e.jsxs($,{children:["موقعك: ",a.latitude.toFixed(6),", ",a.longitude.toFixed(6)]})})]})}),j&&e.jsx("div",{className:"mt-3 p-3 bg-red-50 rounded-lg border border-red-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-red-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-800 mb-1",children:"فشل في تحديد الموقع"}),e.jsx("p",{className:"text-xs text-red-700",children:j})]})]})})]}),!1]})};export{Z as C};
