# ğŸ”€ Ø±Ø³Ù… ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„ - Data Flow Diagram

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 6 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025  
**Ø§Ù„Ù†Ø³Ø®Ø©:** 1.0

---

## ğŸ”„ ØªØ¯ÙÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø·Ø¨Ù‚Ø§Øª

### Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â†’ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ù…Ø³ØªØ®Ø¯Ù… (Customer / Vendor / Admin)                    â”‚
â”‚ - Ù…ØªØµÙØ­ ÙˆÙŠØ¨                                            â”‚
â”‚ - Ø¬Ù‡Ø§Ø² Ù…Ø­Ù…ÙˆÙ„                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ HTTP Request
                â”‚ (JSON)
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Layer (React + TypeScript)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚ â”‚ Page (e.g., ModernStorePage.tsx)             â”‚       â”‚
â”‚ â”‚ - Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…                      â”‚       â”‚
â”‚ â”‚ - Ø¥Ø¯Ø§Ø±Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙƒÙˆÙ† (useState)               â”‚       â”‚
â”‚ â”‚ - Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª                               â”‚       â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚              â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ Service Layer (api.ts, enhancedApi.ts)       â”‚      â”‚
â”‚ â”‚ - Ø¥Ù†Ø´Ø§Ø¡ HTTP Request                         â”‚      â”‚
â”‚ â”‚ - Ø¥Ø¶Ø§ÙØ© Headers (Auth)                       â”‚      â”‚
â”‚ â”‚ - Ù…Ø¹Ø§Ù„Ø¬Ø© Response                            â”‚      â”‚
â”‚ â”‚ - Error Handling                             â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚              â”‚                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚ â”‚ Global State (Context/localStorage)          â”‚      â”‚
â”‚ â”‚ - Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©                         â”‚      â”‚
â”‚ â”‚ - Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø­Ø§Ù„Ø© Ø¨ÙŠÙ† Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª                   â”‚      â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚ HTTP Request (JSON)
                â”‚ Headers: Authorization, Content-Type
                â–¼
```

---

## ğŸ“¡ ØªØ¯ÙÙ‚ Ø§Ù„Ø·Ù„Ø¨-Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©

### Ù…Ø«Ø§Ù„: Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ ÙƒØ§Ù…Ù„Ø©

```
CLIENT                          NETWORK                     SERVER
â”œâ”€ ModernStorePage             
â”‚  â””â”€ ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±
â”‚     â”‚
â”‚     â”œâ”€â”€â–º GET /api/stores â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º storeRoutes
â”‚     â”‚                                                    â”‚
â”‚     â”‚                                                    â”œâ”€â–º storeController.getAll()
â”‚     â”‚                                                    â”‚   â”œâ”€â–º Store.findAll()
â”‚     â”‚                                                    â”‚   â””â”€â–º SELECT * FROM stores
â”‚     â”‚                                                    â”‚
â”‚     â”‚    [{ id, name, logo_url, ... }] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ§Ø¬Ø±
â”‚
â”œâ”€ EnhancedProductPage
â”‚  â””â”€ ÙØªØ­ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬
â”‚     â”‚
â”‚     â”œâ”€â”€â–º GET /api/products/:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º productRoutes
â”‚     â”‚                                                    â”‚
â”‚     â”‚                                                    â”œâ”€â–º productController.getById()
â”‚     â”‚                                                    â”‚   â”œâ”€â–º Product.findByPk(id)
â”‚     â”‚                                                    â”‚   â”œâ”€â–º ProductBadge.findAll()
â”‚     â”‚                                                    â”‚   â””â”€â–º SELECT ... JOIN badges
â”‚     â”‚                                                    â”‚
â”‚     â”‚    {id, name, price, badges, ...} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¹ Ø§Ù„Ø´Ø§Ø±Ø§Øª
â”‚
â”œâ”€ AddToCartPopup
â”‚  â””â”€ Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©
â”‚     â”‚
â”‚     â”œâ”€â”€â–º GET /api/carts (Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù„Ø©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º cartRoutes
â”‚     â”‚    â”‚
â”‚     â”‚    â””â”€ ØªØ­Ø¯ÙŠØ¯ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
â”‚     â”‚
â”‚     â”œâ”€â”€â–º POST /api/carts/items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º cartController
â”‚     â”‚     Body: {cart_id, product_id, qty, ...}        â”‚
â”‚     â”‚                                                    â”œâ”€â–º CartItem.create()
â”‚     â”‚                                                    â”‚   â””â”€â–º INSERT INTO cart_items
â”‚     â”‚                                                    â”‚
â”‚     â”‚    {success: true, item_id} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø§Ø¬Ø­Ø©
â”‚
â”œâ”€ CartPage
â”‚  â””â”€ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
â”‚     â”‚
â”‚     â”œâ”€â”€â–º GET /api/carts/:id/items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º cartController
â”‚     â”‚                                                    â”‚
â”‚     â”‚                                                    â”œâ”€â–º CartItem.findAll()
â”‚     â”‚                                                    â”‚   â”œâ”€â–º SELECT * FROM cart_items
â”‚     â”‚                                                    â”‚   â””â”€â–º JOIN products
â”‚     â”‚                                                    â”‚
â”‚     â”‚    [{ id, product, qty, price, ... }] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â”œâ”€ ØªØ·Ø¨ÙŠÙ‚ ÙƒÙˆØ¨ÙˆÙ†
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€â”€â–º POST /api/coupons/validate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º couponController
â”‚     â”‚        Body: {code: "SALE50"}                      â”‚
â”‚     â”‚                                                    â”œâ”€â–º Coupon.findOne()
â”‚     â”‚                                                    â”‚   â””â”€â–º SELECT * FROM coupons
â”‚     â”‚
â”‚     â”‚       {valid: true, discount: 50} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
â”‚
â”œâ”€ EnhancedCheckoutPage
â”‚  â””â”€ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹
â”‚     â”‚
â”‚     â”œâ”€ Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€â”€ Ø­ÙØ¸ ÙÙŠ Local State
â”‚     â”‚
â”‚     â”œâ”€ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ (Moamalat)
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€â”€â–º POST /api/orders â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º orderController
â”‚     â”‚        Body: {items, customer, shipping, ...}     â”‚
â”‚     â”‚                                                    â”œâ”€â–º Order.create()
â”‚     â”‚                                                    â”œâ”€â–º OrderItem.create() x N
â”‚     â”‚                                                    â”œâ”€â–º Payment.create()
â”‚     â”‚                                                    â”œâ”€â–º Shipping.create()
â”‚     â”‚                                                    â””â”€â–º INSERT in transaction
â”‚     â”‚
â”‚     â”‚       {order_id, total, tracking_url} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ ÙØªØ­ Ù†Ø§ÙØ°Ø© Moamalat
â”‚        â”‚
â”‚        â””â”€â”€â–º Moamalat Lightbox
â”‚             â”‚
â”‚             â”œâ”€ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
â”‚             â”‚
â”‚             â””â”€â–º Moamalat Server (Ø®Ø§Ø±Ø¬ÙŠ)
â”‚                 â”‚
â”‚                 â”œâ”€â–º Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹
â”‚                 â”œâ”€â–º Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
â”‚                 â””â”€â–º Ø±Ø¯ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©
â”‚
â”œâ”€ Callback
â”‚  â””â”€ Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¯ÙØ¹
â”‚     â”‚
â”‚     â”œâ”€ Ù†Ø¬Ø­ âœ…
â”‚     â”‚  â”‚
â”‚     â”‚  â””â”€â”€â–º POST /api/orders/:id/confirm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º orderController
â”‚     â”‚        Body: {payment_id, transaction_id}         â”‚
â”‚     â”‚                                                    â”œâ”€â–º Order.update()
â”‚     â”‚                                                    â”œâ”€â–º Payment.update()
â”‚     â”‚                                                    â”œâ”€â–º Cart.update() [checked_out]
â”‚     â”‚                                                    â””â”€â–º Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯
â”‚     â”‚
â”‚     â”‚       {success: true, invoice} â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     â”‚
â”‚     â””â”€ Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
â”‚
â””â”€ CompleteOrdersPage
   â””â”€ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
      â”‚
      â””â”€â”€â–º GET /api/orders?user_id=:id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º orderController
                                                          â”‚
                                                          â”œâ”€â–º Order.findAll()
                                                          â”‚   â””â”€â–º SELECT * FROM orders
                                                          â”‚
                    [{ id, date, status, total }] â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤
```

---

## ğŸ’¾ ØªØ¯ÙÙ‚ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

### Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PRODUCT CREATION                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                             â”‚
        â–¼                             â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ PRODUCTS    â”‚           â”‚ PRODUCT_BADGES   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ id          â”‚           â”‚ id               â”‚
   â”‚ store_id    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ product_id (FK)  â”‚
   â”‚ name        â”‚           â”‚ badge_type       â”‚
   â”‚ price       â”‚           â”‚ discount_percent â”‚
   â”‚ image_url   â”‚           â”‚ active           â”‚
   â”‚ quantity... â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ORDER WORKFLOW                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                 â”‚              â”‚              â”‚
        â–¼                                 â–¼              â–¼              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ORDERS    â”‚            â”‚  ORDER_ITEMS     â”‚  â”‚ PAYMENTS â”‚  â”‚ SHIPPING â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
   â”‚ id          â”‚â—„â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”‚ order_id (FK)    â”‚  â”‚ order_id â”‚  â”‚ order_id â”‚
   â”‚ user_id     â”‚      â”‚     â”‚ product_id (FK)  â”‚  â”‚ amount   â”‚  â”‚ carrier  â”‚
   â”‚ status      â”‚      â”‚     â”‚ quantity         â”‚  â”‚ status   â”‚  â”‚ tracking â”‚
   â”‚ total       â”‚      â”‚     â”‚ price            â”‚  â”‚ gateway  â”‚  â”‚ status   â”‚
   â”‚ created_at  â”‚      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                        â””â”€ ÙƒÙ„ Ø¹Ù†ØµØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰:
                           - product_id
                           - price_at_purchase
                           - quantity
```

### ØªØ¯ÙÙ‚ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© (Transaction):

```
START TRANSACTION

Step 1: CREATE ORDER
    INSERT INTO orders (user_id, status, total)
    RESULT: order_id

Step 2: CREATE ORDER ITEMS
    FOR EACH item in cart:
        INSERT INTO order_items (order_id, product_id, qty, price)
        UPDATE products SET quantity_stock = quantity_stock - qty
        WHERE id = product_id

Step 3: CREATE PAYMENT
    INSERT INTO payments (order_id, amount, method, status)
    RESULT: payment_id

Step 4: CREATE SHIPPING
    INSERT INTO shipping (order_id, carrier, status)
    RESULT: shipping_id

Step 5: UPDATE CART
    UPDATE carts SET status = 'checked_out'
    WHERE id = cart_id

IF ALL SUCCESS:
    COMMIT
    â†’ Send confirmation email
    â†’ Update inventory
    â†’ Notify store owner

IF ANY FAILED:
    ROLLBACK
    â†’ Restore inventory
    â†’ Clear payment
    â†’ Notify user
    â†’ Log error
```

---

## ğŸ”„ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

### Ø¯ÙˆØ±Ø§Ù† 1: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø«Ø§Ø¨ØªØ© (Static Data)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Sources:    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ products.ts    â”‚ â”
â”‚ â€¢ stores.ts      â”‚ â”œâ”€â–º Frontend Components
â”‚ â€¢ categories.ts  â”‚ â”‚
â”‚ â€¢ cities.ts      â”‚ â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”‚
â””â”€â”€â–º Local State/Context
     â”‚
     â”œâ”€â–º useEffect (lazy load)
     â”‚
     â””â”€â–º render components

```

### Ø¯ÙˆØ±Ø§Ù† 2: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© (Dynamic Data)

```
User Action
    â”‚
    â–¼
Frontend Event Handler
    â”‚
    â”œâ”€â–º Validate Input
    â”‚
    â”œâ”€â–º Create Request
    â”‚
    â–¼
Send to Backend
    â”‚
    â”œâ”€â–º Backend Route
    â”‚   â””â”€â–º Controller
    â”‚       â”œâ”€â–º Validate
    â”‚       â”œâ”€â–º Query Database
    â”‚       â””â”€â–º Process
    â”‚
    â–¼
Response to Frontend
    â”‚
    â”œâ”€â–º Parse JSON
    â”‚
    â”œâ”€â–º Update State
    â”‚
    â””â”€â–º Re-render UI
         â”‚
         â””â”€â–º User sees result
```

### Ø¯ÙˆØ±Ø§Ù† 3: Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Cached Data)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Request Data         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â–º Check localStorage
       â”‚   â”‚
       â”‚   â”œâ”€ Exists & Valid
       â”‚   â”‚  â””â”€â–º Use cached
       â”‚   â”‚
       â”‚   â””â”€ NOT Exists
       â”‚      â””â”€â–º Fetch from server
       â”‚
       â–¼
Process Data
    â”‚
    â”œâ”€â–º Save to localStorage
    â”‚
    â””â”€â–º Update component state
```

---

## ğŸ” ØªØ¯ÙÙ‚ Ø§Ù„Ø£Ù…Ø§Ù† ÙˆØ§Ù„Ù…ØµØ§Ø¯Ù‚Ø©

```
LOGIN REQUEST
    â”‚
    â”œâ”€â–º Input credentials
    â”‚   (email, password)
    â”‚
    â–¼
POST /api/auth/login
    â”‚
    â”œâ”€â–º authController.login()
    â”‚   â”œâ”€â–º Find user
    â”‚   â”œâ”€â–º Compare password (bcrypt)
    â”‚   â””â”€â–º Verify match
    â”‚
    â”œâ”€ NOT MATCH
    â”‚  â””â”€â–º Return 401
    â”‚
    â”œâ”€ MATCH
    â”‚  â”‚
    â”‚  â”œâ”€â–º Generate JWT token
    â”‚  â”‚   â”œâ”€ Payload: {id, email, role}
    â”‚  â”‚   â””â”€ Sign with SECRET
    â”‚  â”‚
    â”‚  â”œâ”€â–º Create session
    â”‚  â”‚
    â”‚  â””â”€â–º Return token + user data
    â”‚
    â–¼
Frontend receives token
    â”‚
    â”œâ”€â–º Save to localStorage
    â”‚   â”‚
    â”‚   â””â”€ OR: httpOnly cookie
    â”‚
    â””â”€â–º Add to request headers
        â””â”€ Authorization: Bearer <token>

SUBSEQUENT REQUESTS
    â”‚
    â”œâ”€â–º Include token in headers
    â”‚
    â–¼
Backend receives request
    â”‚
    â”œâ”€â–º Extract token from headers
    â”‚
    â”œâ”€â–º Verify token
    â”‚   â”œâ”€ Check signature
    â”‚   â”œâ”€ Check expiry
    â”‚   â””â”€ Decode payload
    â”‚
    â”œâ”€ INVALID
    â”‚  â””â”€â–º Return 401 (Unauthorized)
    â”‚
    â”œâ”€ VALID
    â”‚  â”‚
    â”‚  â”œâ”€â–º Get user info from token
    â”‚  â”‚
    â”‚  â”œâ”€â–º Check permissions
    â”‚  â”‚
    â”‚  â”œâ”€ NOT ALLOWED
    â”‚  â”‚  â””â”€â–º Return 403 (Forbidden)
    â”‚  â”‚
    â”‚  â”œâ”€ ALLOWED
    â”‚  â”‚  â””â”€â–º Process request
    â”‚  â”‚
    â”‚  â””â”€ COMPLETE
    â”‚     â””â”€â–º Return response
```

---

## ğŸ“Š Ù…Ù„Ø®Øµ ØªØ¯ÙÙ‚Ø§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

| Ø§Ù„Ø¹Ù…Ù„ÙŠØ© | Ø§Ù„Ø§ØªØ¬Ø§Ù‡ | Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†Ù‚ÙˆÙ„Ø© | Ø§Ù„Ø­Ø§Ù„Ø© |
|--------|--------|-----------------|--------|
| **ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±** | Frontend â† Backend | `[stores]` | Read-only |
| **ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª** | Frontend â† Backend | `[products + badges]` | Read-only |
| **Ø§Ù„Ø¨Ø­Ø«** | Frontend â†’ Backend â†’ Frontend | `{query} â†’ [results]` | Real-time |
| **Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ù„Ø©** | Frontend â†’ Backend | `{product_id, qty}` | Create |
| **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ù„Ø©** | Frontend â†” Backend | `{cart_id, items}` | Update |
| **ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒÙˆØ¨ÙˆÙ†** | Frontend â†’ Backend | `{code}` | Validate |
| **Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨** | Frontend â†’ Backend | `{order_data}` | Create/Transaction |
| **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯ÙØ¹** | Frontend â†” Moamalat | `{payment_data}` | External |
| **ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©** | Backend â†’ Frontend | `{status, tracking}` | Update |
| **Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª** | Backend â†’ Frontend | `{notification}` | Push/Polling |

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:** 6 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025  
**Ø§Ù„Ø­Ø§Ù„Ø©:** âœ… Ø´Ø§Ù…Ù„ ÙˆØ¯Ù‚ÙŠÙ‚
