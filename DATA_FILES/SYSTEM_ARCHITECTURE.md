# 🏗️ البنية المعمارية الكاملة للنظام

**آخر تحديث:** 6 ديسمبر 2025  
**الإصدار:** 1.0

---

## 📊 رسم توضيحي للبنية العامة

```
┌─────────────────────────────────────────────────────────────────┐
│                    مستخدم النظام (User)                        │
│                                                                 │
│              متصفح الويب (Web Browser)                         │
│              (Chrome, Firefox, Safari)                          │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              │ HTTP/HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│              Frontend (واجهة المستخدم)                         │
├─────────────────────────────────────────────────────────────────┤
│ • React + TypeScript                                            │
│ • Tailwind CSS (تصميم احترافي)                                 │
│ • Vite (أداة البناء)                                            │
│ • State Management (Context API / Zustand)                      │
│ • نشر على: Vercel                                              │
├─────────────────────────────────────────────────────────────────┤
│ صفحات رئيسية:                                                  │
│ ├── الصفحة الرئيسية (Home)                                     │
│ ├── صفحة المتاجر (Stores)                                      │
│ ├── صفحة المنتجات (Products)                                   │
│ ├── صفحة تفاصيل المنتج (Product Details)                       │
│ ├── سلة التسوق (Shopping Cart)                                 │
│ ├── الدفع (Checkout)                                           │
│ ├── حسابي (My Account)                                         │
│ └── تاريخ الطلبات (Order History)                              │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              │ REST API
                              │ JSON Data
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│              Backend (خادم التطبيق)                            │
├─────────────────────────────────────────────────────────────────┤
│ • Node.js + Express.js                                          │
│ • TypeScript                                                    │
│ • RESTful API Architecture                                      │
│ • Middleware: Authentication, Validation, Error Handling        │
│ • نشر على: Render                                              │
├─────────────────────────────────────────────────────────────────┤
│ مكونات رئيسية:                                                 │
│ ├── Auth Controller (تسجيل الدخول/التسجيل)                   │
│ ├── Store Controller (إدارة المتاجر)                          │
│ ├── Product Controller (إدارة المنتجات)                       │
│ ├── Order Controller (إدارة الطلبات)                          │
│ ├── Payment Controller (معالجة الدفع)                         │
│ ├── Shipping Controller (إدارة الشحن)                         │
│ └── Admin Controller (لوحة التحكم)                            │
├─────────────────────────────────────────────────────────────────┤
│ الخدمات الخارجية:                                              │
│ ├── Payment Gateway (بوابة الدفع)                             │
│ ├── Email Service (خدمة البريد الإلكتروني)                    │
│ ├── SMS Service (خدمة الرسائل النصية)                         │
│ └── File Storage (تخزين الملفات/الصور)                        │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              │ SQL Queries
                              │ Connection Pool
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│            قاعدة البيانات (Database)                          │
├─────────────────────────────────────────────────────────────────┤
│ • MySQL 8+                                                      │
│ • عمليات CRUD كاملة                                            │
│ • Transactions (معاملات آمنة)                                  │
│ • Backup & Recovery                                            │
├─────────────────────────────────────────────────────────────────┤
│ الجداول الأساسية:                                              │
│ ├── users (المستخدمون)                                         │
│ ├── stores (المتاجر)                                           │
│ ├── products (المنتجات)                                        │
│ ├── product_badges (شارات المنتجات)                           │
│ ├── orders (الطلبات)                                           │
│ ├── order_items (عناصر الطلب)                                  │
│ ├── cart (سلة التسوق)                                          │
│ ├── payments (المدفوعات)                                       │
│ ├── shipping (الشحن)                                           │
│ └── admin_logs (سجلات الإدارة)                                │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔀 تدفق الطلب والاستجابة

```
المستخدم يضغط زر
         │
         ▼
Frontend يرسل HTTP Request
         │
         ▼
Backend يستقبل الطلب
         │
         ├─────► التحقق من الصحة (Validation)
         │
         ├─────► التحقق من المصادقة (Authentication)
         │
         ├─────► التحقق من الصلاحيات (Authorization)
         │
         ▼
معالجة الطلب
         │
         ├─────► الوصول لقاعدة البيانات
         │
         ├─────► معالجة البيانات
         │
         ├─────► تطبيق القواعد التجارية
         │
         ▼
إرسال الاستجابة JSON
         │
         ▼
Frontend يستقبل البيانات
         │
         ▼
تحديث واجهة المستخدم (UI Update)
         │
         ▼
عرض النتيجة للمستخدم
```

---

## 🏢 المكونات الرئيسية

### 1️⃣ **Frontend (React + TypeScript)**

#### الوظائف الأساسية:
- عرض المتاجر والمنتجات
- البحث والتصفية
- إدارة السلة
- معالجة الدفع
- عرض سجل الطلبات
- ملف المستخدم الشخصي

#### الحالات المتعددة:
- `Idle` - في انتظار الإجراء
- `Loading` - جارية عملية تحميل
- `Success` - عملية ناجحة
- `Error` - حدث خطأ

### 2️⃣ **Backend (Node.js + Express)**

#### الطبقات:
```
Routes (المسارات)
   │
   ▼
Middleware (الوسيطة: Auth, Validation)
   │
   ▼
Controllers (معالجات الطلبات)
   │
   ▼
Services (الخدمات: Logic)
   │
   ▼
Models (نماذج قاعدة البيانات)
   │
   ▼
Database (قاعدة البيانات)
```

#### المسارات (Routes):
- `POST /api/auth/login` - تسجيل الدخول
- `POST /api/auth/register` - إنشاء حساب
- `GET /api/stores` - قائمة المتاجر
- `GET /api/products` - المنتجات
- `POST /api/orders` - إنشاء طلب
- `POST /api/payments` - معالجة الدفع

### 3️⃣ **قاعدة البيانات (MySQL)**

#### الخصائص:
- علاقات معقدة بين الجداول
- مفاتيح خارجية (Foreign Keys)
- فهارس (Indexes) لتحسين الأداء
- قيود (Constraints) لسلامة البيانات
- Transactions للعمليات الحساسة

---

## 🔒 الأمان والمصادقة

```
مستخدم يدخل كلمة المرور
         │
         ▼
Hashing (تشفير كلمة المرور)
         │
         ▼
JWT Token (توليد رمز)
         │
         ▼
إرسال Token للعميل
         │
         ▼
حفظ Token في LocalStorage/Cookies
         │
         ▼
إرسال Token مع كل طلب
         │
         ▼
Backend يتحقق من صحة Token
         │
         ▼
المستخدم حقيقي ✓ أو مزيف ✗
```

---

## 📈 قابلية التوسع (Scalability)

### الحالية:
- Single Server
- MySQL Database
- File Storage

### المستقبلية:
- Load Balancing
- Database Replication
- CDN للصور
- Caching (Redis/Memcached)
- Microservices

---

## ⚙️ التكنولوجيا المستخدمة

| الطبقة | التكنولوجيا | الإصدار |
|-------|----------|--------|
| **Frontend** | React | 18+ |
| | TypeScript | 5+ |
| | Tailwind CSS | 3+ |
| | Vite | 4+ |
| **Backend** | Node.js | 18+ |
| | Express | 4+ |
| | TypeScript | 5+ |
| **Database** | MySQL | 8+ |
| **Deployment** | Vercel (Frontend) | - |
| | Render (Backend) | - |

---

**للمزيد:** اطلع على:
- [DATABASE_DESIGN.md](DATABASE_DESIGN.md) - تصميم قاعدة البيانات
- [DATA_FLOW.md](DATA_FLOW.md) - تدفق البيانات
- [WORKFLOW_DESIGN.md](WORKFLOW_DESIGN.md) - سير العمل
