import{u as A}from"./index-CcNjQh2v.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],v=A("tag",M),g={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"https://www.ishro.ly/api",VITE_BACKEND_URL:"http://localhost:5000",VITE_CORS_ORIGIN:"http://localhost:5174",VITE_FRONTEND_URL:"https://www.ishro.ly",VITE_GOOGLE_CLIENT_ID:"1034286241802-hkdlf7mua6img2vhdo6mhna8ghb3mmhg.apps.googleusercontent.com",VITE_GOOGLE_REDIRECT_URI:"https://www.ishro.ly/auth/google/callback",VITE_MINIMAX_API_KEY:"your-production-minimax-api-key",VITE_MINIMAX_API_URL:"https://api.minimax.chat/v1",VITE_MINIMAX_ENABLED:"false",VITE_MINIMAX_TIMEOUT:"5000",VITE_MOAMALAT_HASH_ENDPOINT:"http://localhost:5000",VITE_USER_NODE_ENV:"production"};var p={};const T="https://tnpg.moamalat.net:6006/js/lightbox.js",E="https://pgw.moamalat.net:6006/js/lightbox.js",D="10081014649",L="99179395",y="3a488a89b3f7993476c252f017c488bb",C="434";let h=null,w="sandbox",m=T;function f(t){const e=typeof window<"u"?window:{},r=typeof process<"u"?p??{}:{},n=typeof import.meta<"u"?g??{}:{};return r[`NEXT_PUBLIC_${t}`]??r[`VITE_${t}`]??n[`NEXT_PUBLIC_${t}`]??n[`VITE_${t}`]??r[t]??e[t]}function _(...t){for(const e of t){const r=f(e);if(r!=null&&r!=="")return r}}function O(t){const e=i=>String(i).padStart(2,"0"),r=t.getFullYear(),n=e(t.getMonth()+1),a=e(t.getDate()),c=e(t.getHours()),o=e(t.getMinutes());return`${r}${n}${a}${c}${o}`}async function I(t){var r;if(typeof window>"u")return;t&&w!==t&&(w=t),m=w==="production"?E:T;let e=document.querySelector("script[data-moamalat]");e&&e.src!==m&&(e.remove(),e=null,window.Lightbox=void 0,h=null),!((r=window.Lightbox)!=null&&r.Checkout&&e)&&(h||(h=new Promise((n,a)=>{const c=document.querySelector("script[data-moamalat]");if(c){c.addEventListener("load",()=>n(),{once:!0}),c.addEventListener("error",()=>a(new Error("فشل تحميل سكربت بوابة معاملات")),{once:!0});return}const o=document.createElement("script");o.src=m,o.async=!0,o.dataset.moamalat=m,o.onload=()=>n(),o.onerror=()=>a(new Error("فشل تحميل سكربت بوابة معاملات")),document.head.appendChild(o)}).then(async()=>{var a;const n=Date.now();for(;!((a=window.Lightbox)!=null&&a.Checkout);){if(Date.now()-n>8e3)throw new Error("Lightbox SDK لم يصبح جاهزاً");await new Promise(c=>setTimeout(c,100))}}).catch(n=>{throw h=null,n})),await h)}async function b(){try{const t=await fetch("/api/moamalat/config");return t.ok?await t.json():{}}catch{return{}}}async function S(){let t=_("MOAMALAT_MID","MOAMALATPAY_MID"),e=_("MOAMALAT_TID","MOAMALATPAY_TID"),r=f("MOAMALAT_ENV");if(!r){const i=f("MOAMALATPAY_PRODUCTION");r=i&&i.toLowerCase()==="true"?"production":void 0}if(!t||!e){const{MID:i,TID:s,ENV:u}=await b();t=t??i,e=e??s,r=r??u}if(t=t??D,e=e??L,!t||!e)throw new Error("بيانات التاجر غير مكتملة (MID/TID)");const n=r&&r.toLowerCase()==="production"?"production":"sandbox",a=typeof window<"u"?window.location.hostname:"",o=a==="localhost"||a==="127.0.0.1"||a===""?"sandbox":n;return w=o,m=o==="production"?E:T,{MID:t,TID:e,ENV:o}}async function x(t){try{const e=await fetch("/api/moamalat/hash",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.text();throw new Error(n||"Hash endpoint error")}const r=await e.json();if(!r.secureHash)throw new Error("لم يتم استلام SecureHash من الخادم");return r.secureHash}catch(e){const r=window.__MOAMALAT_TEST_KEY__??y;if(!r)throw e instanceof Error?e:new Error("فشل توليد SecureHash");window.__MOAMALAT_TEST_KEY__=r;const n=`Amount=${t.Amount}&DateTimeLocalTrxn=${t.DateTimeLocalTrxn}&MerchantId=${t.MerchantId}&MerchantReference=${t.MerchantReference}&TerminalId=${t.TerminalId}`;return await N(n,r)}}async function N(t,e){if(typeof crypto>"u"||!crypto.subtle)throw new Error("HMAC غير مدعوم في هذا المتصفح");const n=(o=>{const i=new Uint8Array(o.length/2);for(let s=0;s<i.length;s+=1)i[s]=parseInt(o.substr(s*2,2),16);return i})(e.trim()),a=await crypto.subtle.importKey("raw",n,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),c=await crypto.subtle.sign("HMAC",a,new TextEncoder().encode(t));return Array.from(new Uint8Array(c)).map(o=>o.toString(16).padStart(2,"0")).join("").toUpperCase()}async function U(t){const{MID:e,TID:r,ENV:n}=await S();await I(n);const a=String(Math.round(Number(t.amountLYD)*100)),c=O(new Date),o=`${t.referencePrefix??"ESH"}-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,s=await x({Amount:a,DateTimeLocalTrxn:c,MerchantId:e,MerchantReference:o,TerminalId:r}),u={MID:e,TID:r,AmountTrxn:a,MerchantReference:o,TrxDateTime:c,SecureHash:s,CurrencyCode:C,MOAMALATPAY_PRODUCTION:n==="production",ReturnUrl:t.returnUrl??`${window.location.origin}/payment-success`,CallbackUrl:t.callbackUrl??`${window.location.origin}/payment-callback`,completeCallback:l=>{var d;(d=t.onComplete)==null||d.call(t,l)},errorCallback:l=>{var d;(d=t.onError)==null||d.call(t,l)},cancelCallback:()=>{var l;(l=t.onCancel)==null||l.call(t)}};return t.orderId&&(u.OrderId=t.orderId),t.customerEmail&&(u.CustomerEmail=t.customerEmail),t.customerMobile&&(u.CustomerMobile=t.customerMobile),t.additionalConfig&&Object.assign(u,t.additionalConfig),window.Lightbox.Checkout.configure=u,window.Lightbox.Checkout.showLightbox(),o}async function H(){await I()}export{v as T,H as e,U as o};
